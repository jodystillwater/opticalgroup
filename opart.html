<!DOCTYPE html>
<html>

<head>
  <title>opticalgroup</title>
  <link rel="stylesheet" href="opart.css">
  <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
  <script src="js/lib/Tone.js"></script>
  <script src="js/lib/Interface.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <!-- custom cursor -->
  <script type="text/javascript">
    $(document).ready(function(){
      $('.background').mousemove(function(e){
        var w = $('#mycursor').outerWidth()
        var h = $('#mycursor').outerHeight()
        $('#mycursor').css('left', e.clientX - w/2).css('top', e.clientY - h/2);
      });
      $('.background').mousedown(function(){
        $(this).css("backgroundColor", "black");
      });
    });
  </script>
</head>

<body>
  <div id="Content" class="FullScreen">
    <div id="Title">Microphone</div>
  </div>
  <div class="background">
    <div></div>
  </div>
  <div id="mycursor"></div>

  <!--   adapted from https://tonejs.github.io/examples/#mic-->
  <script>
    var mic = new Tone.UserMedia();
    var analyser = new Tone.Waveform(256);
    mic.connect(analyser);

    // GUI //
    //indicate if the microphone is supported or not
    if (!Tone.UserMedia.supported){
      $("<div>", {
        "id" : "NotSupported",
        "text" : "getUserMedia is not supported by your browser."
      }).appendTo("#Content");
    } else {

      var canvas = $("<canvas>").appendTo("#Content");
      var context = canvas.get(0).getContext("2d");
      context.canvas.width = canvas.width();
      context.canvas.height = canvas.height();

      function drawLoop(){
        var canvasWidth = context.canvas.width;
        var canvasHeight = context.canvas.height;
        requestAnimationFrame(drawLoop);

        // TODO: remove this, convert effect/viz
        //draw the waveform
        context.clearRect(0, 0, canvasWidth, canvasHeight);
        var values = analyser.getValue();
        context.beginPath();
        context.lineJoin = "round";
        context.lineWidth = 6;
        context.strokeStyle = "white";
        context.moveTo(0, (values[0] + 1) / 2 * canvasHeight);
        for (var i = 1, len = values.length; i < len; i++){
          var val = (values[i] + 1) / 2;
          var x = canvasWidth * (i / (len - 1));
          var y = val * canvasHeight;
          context.lineTo(x, y);
        }
        context.stroke();
      }
      drawLoop();

      // TODO: change this button to trigger on keypress/keyup/keydown
      Interface.Button({
        type : "toggle",
        text : "Open Mic",
        activeText : "Close Mic",
        start : function(){
          mic.open();
        },
        end : function(){
          mic.close();
        }
      });
    }
  </script>

</body>

</html>
